<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Station Breach | Space Escape</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        :root {
            --primary: #00ffff;
            --secondary: #ff00ff;
            --accent: #facc15;
            --danger: #ff3366;
            --bg: #02020a;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg);
            font-family: 'Orbitron', sans-serif;
            touch-action: none;
            user-select: none;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
        }

        .hidden { display: none !important; }

        .logo {
            font-weight: 900;
            font-size: clamp(2rem, 8vw, 4rem);
            margin-bottom: 20px;
            line-height: 0.9;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(0, 255, 255, 0.4));
        }

        .score-hud {
            position: absolute;
            top: 20px;
            font-size: 4rem;
            font-weight: 900;
            z-index: 10;
            color: white;
            opacity: 0.8;
            text-shadow: 0 0 20px var(--primary);
        }

        .high-score-hud {
            position: absolute;
            top: 85px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
        }

        .btn-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: auto;
        }

        button {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 16px 40px;
            font-size: 1.2rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-transform: uppercase;
            backdrop-filter: blur(5px);
        }

        button:hover {
            transform: scale(1.05) translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
            border-color: white;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }

        button:active { transform: scale(0.95); }

        .btn-easy { color: #4ade80; border-color: #4ade80; }
        .btn-medium { color: #facc15; border-color: #facc15; }
        .btn-hard { color: #f87171; border-color: #f87171; }

        .game-over-card {
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .instruction {
            margin-top: 30px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 1px;
        }

        .watermark {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.2);
            letter-spacing: 4px;
            text-transform: uppercase;
            pointer-events: none;
            z-index: 5;
        }
    </style>
</head>
<body>

    <div class="score-hud hidden" id="scoreDisplay">0</div>
    <div class="high-score-hud hidden" id="highScoreDisplay">BEST: 0</div>
    <div class="watermark">CosmoRun</div>

    <div id="ui-layer">
        <div id="startScreen">
            <div class="logo">STATION<br>BREACH</div>
            <p style="color: rgba(255,255,255,0.7); margin-bottom: 30px;">Escape the orbital blockade</p>
            <div class="btn-container">
                <button class="btn-easy" onclick="initGame('EASY')">EASY MODE</button>
                <button class="btn-medium" onclick="initGame('MEDIUM')">MEDIUM MODE</button>
                <button class="btn-hard" onclick="initGame('HARD')">HARD MODE</button>
            </div>
            <div class="instruction">SPACEBAR OR TAP TO THRUST</div>
        </div>

        <div id="gameOverScreen" class="hidden">
            <div class="game-over-card">
                <h1 style="color: var(--danger); font-size: 3rem; margin: 0;">CRASHED</h1>
                <div style="margin: 30px 0;">
                    <div style="font-size: 1rem; color: #aaa;">FINAL SCORE</div>
                    <div id="finalScore" style="font-size: 4rem; font-weight: 900;">0</div>
                </div>
                <div style="margin-bottom: 30px; color: var(--accent);">
                    BEST SCORE: <span id="finalBest">0</span>
                </div>
                <div class="btn-container">
                    <button id="restartBtn" style="border-color: white;">TRY AGAIN</button>
                </div>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const AudioEngine = {
            ctx: null,
            init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            playClick() {
                this.init();
                const o = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                o.frequency.setValueAtTime(600, this.ctx.currentTime);
                o.frequency.exponentialRampToValueAtTime(100, this.ctx.currentTime + 0.1);
                g.gain.setValueAtTime(0.1, this.ctx.currentTime);
                g.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.1);
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); o.stop(this.ctx.currentTime + 0.1);
            },
            playBoost() {
                this.init();
                const o = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                o.type = 'triangle';
                o.frequency.setValueAtTime(120, this.ctx.currentTime);
                o.frequency.exponentialRampToValueAtTime(40, this.ctx.currentTime + 0.2);
                g.gain.setValueAtTime(0.1, this.ctx.currentTime);
                g.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.2);
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); o.stop(this.ctx.currentTime + 0.2);
            },
            playScore() {
                this.init();
                const o = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                o.frequency.setValueAtTime(880, this.ctx.currentTime);
                o.frequency.exponentialRampToValueAtTime(1760, this.ctx.currentTime + 0.1);
                g.gain.setValueAtTime(0.05, this.ctx.currentTime);
                g.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.1);
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); o.stop(this.ctx.currentTime + 0.1);
            },
            playCrash() {
                this.init();
                const o = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                o.type = 'sawtooth';
                o.frequency.setValueAtTime(100, this.ctx.currentTime);
                o.frequency.linearRampToValueAtTime(10, this.ctx.currentTime + 0.5);
                g.gain.setValueAtTime(0.2, this.ctx.currentTime);
                g.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.5);
                o.connect(g); g.connect(this.ctx.destination);
                o.start(); o.stop(this.ctx.currentTime + 0.5);
            }
        };

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const uiStart = document.getElementById('startScreen');
        const uiGameOver = document.getElementById('gameOverScreen');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const highScoreDisplay = document.getElementById('highScoreDisplay');
        const restartBtn = document.getElementById('restartBtn');

        let frames = 0;
        let gameState = 'START';
        let score = 0;
        let highScore = parseInt(localStorage.getItem('stationBreachHighScore')) || 0;
        
        let gameSpeed = 5;
        let speedMultiplier = 1;
        let spawnRate = 100;
        let meteoriteRate = 120;
        let shake = 0;

        const particles = [];
        class Particle {
            constructor(x, y, color, size, vx, vy) {
                this.x = x; this.y = y; this.color = color;
                this.size = size; this.vx = vx; this.vy = vy;
                this.alpha = 1;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                this.alpha -= 0.02;
            }
            draw() {
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.size, this.size);
                ctx.globalAlpha = 1;
            }
        }

        function createExplosion(x, y, color) {
            for(let i=0; i<30; i++) {
                particles.push(new Particle(x, y, color, 2+Math.random()*6, (Math.random()-0.5)*15, (Math.random()-0.5)*15));
            }
            shake = 20;
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initBackground();
        }
        window.addEventListener('resize', resize);

        const backgroundLayers = { nebulae: [], stars: [] };
        function initBackground() {
            backgroundLayers.nebulae = []; backgroundLayers.stars = [];
            for(let i=0; i<3; i++) {
                backgroundLayers.nebulae.push({
                    x: Math.random() * canvas.width, y: Math.random() * canvas.height,
                    r: 400 + Math.random()*400, color: i===0?'#1e1b4b':i===1?'#312e81':'#1e293b'
                });
            }
            for(let i=0; i<150; i++) {
                backgroundLayers.stars.push({
                    x: Math.random()*canvas.width, y: Math.random()*canvas.height,
                    s: Math.random()*2, v: 0.2 + Math.random()*0.8
                });
            }
        }

        const ship = {
            x: 0, y: 0, w: 50, h: 45, vel: 0, grav: 0.35, jump: 7.5, rot: 0,
            reset() { this.x = canvas.width * 0.2; this.y = canvas.height/2; this.vel = 0; this.rot = 0; },
            update() {
                this.vel += this.grav; this.y += this.vel;
                this.rot = Math.max(-0.4, Math.min(this.vel * 0.06, 0.6));
                if (this.y < 0 || this.y > canvas.height) gameOver();
                if (frames % 2 === 0 && gameState === 'PLAYING') {
                    particles.push(new Particle(this.x - 20, this.y + (Math.random()-0.5)*15, '#facc15', 2, -4, (Math.random()-0.5)*3));
                }
            },
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rot);
                
                // Outer Wing Shadows
                ctx.shadowBlur = 10; ctx.shadowColor = 'black';
                
                // 1. Red Main Wings (The base shape)
                ctx.fillStyle = '#cc0000';
                ctx.beginPath();
                ctx.moveTo(35, 0);       // Nose
                ctx.lineTo(-20, -25);    // Top back tip
                ctx.lineTo(-10, 0);      // Mid back
                ctx.lineTo(-20, 25);     // Bottom back tip
                ctx.closePath();
                ctx.fill();

                // 2. Grey Inner Fuselage
                ctx.fillStyle = '#64748b';
                ctx.beginPath();
                ctx.moveTo(25, 0);
                ctx.lineTo(-15, -12);
                ctx.lineTo(-5, 0);
                ctx.lineTo(-15, 12);
                ctx.closePath();
                ctx.fill();

                // 3. Nose Tip
                ctx.fillStyle = '#94a3b8';
                ctx.beginPath();
                ctx.moveTo(35, 0);
                ctx.lineTo(15, -5);
                ctx.lineTo(15, 5);
                ctx.closePath();
                ctx.fill();

                // 4. Yellow Accents (Intakes)
                ctx.fillStyle = '#facc15';
                ctx.fillRect(-5, -18, 12, 6);
                ctx.fillRect(-5, 12, 12, 6);

                // 5. Cockpit (Dark Blue/Glass)
                ctx.fillStyle = '#1e293b';
                ctx.beginPath();
                ctx.ellipse(5, 0, 10, 5, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#38bdf8';
                ctx.lineWidth = 1;
                ctx.stroke();

                // 6. Thrust Exhaust (Grey Pipe)
                ctx.fillStyle = '#334155';
                ctx.fillRect(-20, -5, 10, 10);

                // 7. Outline for crispness
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(35, 0); ctx.lineTo(-20, -25); ctx.lineTo(-10, 0); ctx.lineTo(-20, 25); ctx.closePath();
                ctx.stroke();

                ctx.restore();
            }
        };

        class Obstacle {
            constructor() {
                this.x = canvas.width + 100;
                this.w = 80;
                this.gap = Math.max(200, 320 - score * 2);
                this.y = 100 + Math.random() * (canvas.height - 200 - this.gap);
                this.passed = false;
            }
            update() { this.x -= gameSpeed * speedMultiplier; }
            draw() {
                const grad = ctx.createLinearGradient(this.x, 0, this.x + this.w, 0);
                grad.addColorStop(0, '#1e293b'); grad.addColorStop(0.5, '#475569'); grad.addColorStop(1, '#0f172a');
                ctx.fillStyle = grad;
                ctx.strokeStyle = '#38bdf8';
                ctx.lineWidth = 3;
                
                // Top Pillar
                ctx.fillRect(this.x, 0, this.w, this.y);
                ctx.strokeRect(this.x, -5, this.w, this.y + 5);
                // Bottom Pillar
                ctx.fillRect(this.x, this.y + this.gap, this.w, canvas.height);
                ctx.strokeRect(this.x, this.y + this.gap, this.w, canvas.height);
                
                // Warning Light at Gate
                const pulse = (Math.sin(frames * 0.1) + 1) / 2;
                ctx.fillStyle = `rgba(255, 51, 102, ${pulse})`;
                ctx.beginPath(); ctx.arc(this.x + this.w/2, this.y - 15, 6, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(this.x + this.w/2, this.y + this.gap + 15, 6, 0, Math.PI*2); ctx.fill();
            }
            check(px, py) {
                if (px + 18 > this.x && px - 18 < this.x + this.w) {
                    if (py - 15 < this.y || py + 15 > this.y + this.gap) return true;
                }
                return false;
            }
        }

        class Rock {
            constructor() {
                this.x = canvas.width + 100;
                this.y = Math.random() * canvas.height;
                this.r = 15 + Math.random() * 20;
                this.v = (gameSpeed + 2 + Math.random() * 4) * speedMultiplier;
                this.rot = 0;
                this.rv = (Math.random()-0.5) * 0.1;
            }
            update() { this.x -= this.v; this.rot += this.rv; }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rot);
                ctx.fillStyle = '#475569';
                ctx.beginPath();
                for(let i=0; i<6; i++) {
                    const a = (i/6) * Math.PI * 2;
                    const r = this.r * (0.8 + Math.random()*0.4);
                    if(i===0) ctx.moveTo(Math.cos(a)*r, Math.sin(a)*r);
                    else ctx.lineTo(Math.cos(a)*r, Math.sin(a)*r);
                }
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = '#1e293b'; ctx.lineWidth = 2; ctx.stroke();
                ctx.restore();
            }
            check(px, py) {
                const dx = px - this.x; const dy = py - this.y;
                return Math.sqrt(dx*dx + dy*dy) < (this.r + 18);
            }
        }

        const obstacles = [];
        const rocks = [];

        function initGame(diff) {
            AudioEngine.playClick();
            switch(diff) {
                case 'EASY': gameSpeed = 4; spawnRate = 130; meteoriteRate = 180; ship.grav = 0.3; break;
                case 'MEDIUM': gameSpeed = 5.5; spawnRate = 100; meteoriteRate = 130; ship.grav = 0.35; break;
                case 'HARD': gameSpeed = 7.5; spawnRate = 80; meteoriteRate = 90; ship.grav = 0.45; break;
            }
            ship.reset(); obstacles.length = 0; rocks.length = 0; particles.length = 0;
            score = 0; frames = 0; speedMultiplier = 1;
            uiStart.classList.add('hidden'); uiGameOver.classList.add('hidden');
            scoreDisplay.classList.remove('hidden'); scoreDisplay.innerText = 0;
            highScoreDisplay.classList.remove('hidden'); highScoreDisplay.innerText = "BEST: " + highScore;
            gameState = 'PLAYING';
            loop();
        }

        function gameOver() {
            if (gameState === 'GAMEOVER') return;
            gameState = 'GAMEOVER';
            AudioEngine.playCrash();
            createExplosion(ship.x, ship.y, '#ff3366');
            if (score > highScore) { highScore = score; localStorage.setItem('stationBreachHighScore', highScore); }
            document.getElementById('finalScore').innerText = score;
            document.getElementById('finalBest').innerText = highScore;
            scoreDisplay.classList.add('hidden');
            setTimeout(() => uiGameOver.classList.remove('hidden'), 500);
        }

        function loop() {
            if (gameState === 'START') return;

            let sx = 0, sy = 0;
            if (shake > 0) {
                sx = (Math.random() - 0.5) * shake;
                sy = (Math.random() - 0.5) * shake;
                shake *= 0.9;
            }

            ctx.setTransform(1, 0, 0, 1, sx, sy);
            ctx.fillStyle = '#02020a'; ctx.fillRect(-50, -50, canvas.width+100, canvas.height+100);

            backgroundLayers.nebulae.forEach(n => {
                const g = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.r);
                g.addColorStop(0, n.color); g.addColorStop(1, 'transparent');
                ctx.fillStyle = g; ctx.globalAlpha = 0.3; ctx.fillRect(0,0,canvas.width,canvas.height);
            });
            ctx.globalAlpha = 1;
            backgroundLayers.stars.forEach(s => {
                s.x -= s.v * speedMultiplier; if(s.x < 0) s.x = canvas.width;
                ctx.fillStyle = '#ffffff44'; ctx.fillRect(s.x, s.y, s.s, s.s);
            });

            if (gameState === 'PLAYING') {
                frames++;
                if (frames % Math.floor(spawnRate / speedMultiplier) === 0) obstacles.push(new Obstacle());
                if (frames % Math.floor(meteoriteRate / speedMultiplier) === 0) rocks.push(new Rock());

                for(let i=obstacles.length-1; i>=0; i--) {
                    const o = obstacles[i]; o.update(); o.draw();
                    if (o.check(ship.x, ship.y)) gameOver();
                    if (!o.passed && o.x + o.w < ship.x) {
                        o.passed = true; score++; scoreDisplay.innerText = score;
                        AudioEngine.playScore();
                        if (score % 5 === 0) speedMultiplier += 0.05;
                    }
                    if (o.x < -200) obstacles.splice(i, 1);
                }

                for(let i=rocks.length-1; i>=0; i--) {
                    const r = rocks[i]; r.update(); r.draw();
                    if (r.check(ship.x, ship.y)) gameOver();
                    if (r.x < -100) rocks.splice(i, 1);
                }

                ship.update();
            }

            for(let i=particles.length-1; i>=0; i--) {
                particles[i].update(); particles[i].draw();
                if (particles[i].alpha <= 0) particles.splice(i, 1);
            }

            ship.draw();
            requestAnimationFrame(loop);
        }

        function handleInput(e) {
            if (e.target.tagName === 'BUTTON') return;
            if (gameState === 'PLAYING') {
                e.preventDefault();
                ship.vel = -ship.jump;
                AudioEngine.playBoost();
                for(let i=0; i<8; i++) {
                    particles.push(new Particle(ship.x - 20, ship.y, '#facc15', 3, -3-Math.random()*6, (Math.random()-0.5)*6));
                }
            }
        }

        window.addEventListener('mousedown', handleInput);
        window.addEventListener('touchstart', handleInput, {passive: false});
        window.addEventListener('keydown', e => { if(e.code === 'Space') handleInput(e); });
        
        restartBtn.onclick = () => {
            AudioEngine.playClick();
            uiGameOver.classList.add('hidden');
            uiStart.classList.remove('hidden');
            gameState = 'START';
        };

        resize();
    </script>
</body>
</html>
